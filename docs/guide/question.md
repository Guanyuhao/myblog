# æ€è€ƒ

## node.js å®ç°é˜»å¡

```js
/*
fs.readdir(path[, options], callback)

fs.readdirSync(path[, options])

*/
const fs = require("path");
const path = require("path");
const rootpath = path.dirname(__dirname);
const docs = rootpath + "/docs/";
let fileDirectoryName = [];
fs.readdir(docs, (err, files) => {
  fileDirectoryName = files;
});
console.log(fileDirectoryName); // []
fileDirectoryName = fs.readdirSync(docs);
console.log(fileDirectoryName); // [...ç›®å½•]
```

::: success
ğŸ‘† ç»“æœå‡ºç°çš„åŸå› å¾ˆç®€å•ï¼Œå› ä¸ºå¼‚æ­¥äº†ã€‚readdirSync å‘ç”Ÿäº†é˜»å¡äº†è€Œ readdir æ²¡æœ‰ã€‚
â“ å¼•å‡ºä¸€ä¸ªé—®é¢˜ node.js å®ç°é˜»å¡ï¼Ÿ
:::

---

### è¯´ä¸€è¯´

node.js çš„å•çº¿ç¨‹ä»…ä»…æŒ‡ javascript å¼•æ“æ˜¯å•çº¿ç¨‹çš„ï¼Œæ— è®ºå¦‚ä½•æˆ‘ä»¬æ²¡æœ‰åŠæ³•åœ¨ javascript ä¸­å®ç°å¤šçº¿ç¨‹å’Œé˜»å¡ï¼›ä½†å¯¹äº node.js çš„å…¶ä»–æ–¹é¢ä¸ä»£è¡¨ä¸èƒ½å¤šçº¿ç¨‹ï¼Œä¾‹å¦‚ IOã€‚å¦‚æœç°åœ¨ node.js é­å—å¤§é‡è¯·æ±‚ï¼Œè€Œè¿™äº›è¯·æ±‚éƒ½æ˜¯ IO å¯†é›†å‹çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶ node æ¯æ¥å—ä¸€ä¸ªè¯·æ±‚ï¼Œåœ¨é‡åˆ°è€—æ—¶è¾ƒé•¿çš„ IO æ“ä½œæ—¶ï¼Œjavascript çº¿ç¨‹å¹¶ä¸ä¼šä¸€ç›´åœ¨æ­¤ç­‰å¾…ï¼Œè€Œæ˜¯äº¤å‡ºæ§åˆ¶ï¼Œåœ¨å›è°ƒå †æ ˆé‡Œæ·»åŠ  IO æ“ä½œå®Œæˆåè¦æ‰§è¡Œçš„æ“ä½œã€‚

è€Œåœ¨è¿™æ®µæ—¶é—´å†…ï¼Œnode.js åˆå¯ä»¥å¤„ç†å…¶ä»–è¯·æ±‚äº†ã€‚æ‰€ä»¥å¯¹äº node.js è€Œè¨€ï¼Œè™½ç„¶ javascript æ˜¯å•çº¿ç¨‹çš„ï¼Œæ¯æ¬¡åªèƒ½å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œä½† javascript å¤„ç†ä¸€ä¸ªè¯·æ±‚çš„æ—¶é—´å¾€å¾€è¾ƒçŸ­ï¼ˆå¯¹äº IO å¯†é›†å‹åº”ç”¨è€Œè¨€ï¼‰ï¼Œåªè¦å¯ä»¥å¼‚æ­¥å¤„ç†ï¼Œé‚£ä¹ˆåœ¨å¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œæ­¤æ¬¡è¯·æ±‚éƒ½ä¼šé‡Šæ”¾æ§åˆ¶ï¼Œä½¿ node.js èƒ½å¤„ç†å…¶ä»–è¯·æ±‚ã€‚

è¿™å¹¶å‘è¯·æ±‚çš„åŒæ—¶ï¼ŒIO å…¶å®ä¸€ç›´å¤„äºå¹¶å‘çŠ¶æ€ï¼Œå‡å°‘å¤„ç†è¯·æ±‚çš„çº¿ç¨‹æ•°ï¼ŒèŠ‚çº¦èµ„æºä»¥å¢åŠ  IO çš„çº¿ç¨‹æ•°ï¼Œå¯¹äºé€šå¸¸è€—æ—¶å¾ˆé•¿çš„ IO å¯†é›†å‹è¯·æ±‚æ¥è¯´ï¼Œæ— ç–‘èƒ½å¸¦æ¥æ€§èƒ½ä¸Šçš„æå‡ã€‚

å‰é¢å•°å•°å—¦å—¦åœ°ä¸€ç›´åœ¨å¼ºè°ƒ IO å¯†é›†å‹ï¼Œå…¶å®æ˜¯åœ¨å¼ºè°ƒ node.js çš„å¼ºé¡¹ã€‚ç›¸åº”çš„ï¼Œå®ƒçš„çŸ­æ¿å°±æ˜¯ CPU å¯†é›†å‹çš„è¯·æ±‚ã€‚é“ç†å¾ˆç®€å•ï¼Œjavascript ä¸ä¼šå¹¶å‘ï¼Œåªèƒ½ä¸€ä¸ªè¯·æ±‚å®Œæˆåæ‰èƒ½å¤„ç†å…¶ä»–è¯·æ±‚ã€‚ä¸€ä¸ªè¯·æ±‚å¤„ç†çš„æ—¶é—´è¶Šé•¿ï¼Œå…¶ä»–è¯·æ±‚ç­‰å¾…çš„æ—¶é—´è¶Šé•¿ã€‚åŒä¸€æ—¶é—´åªä¼šæœ‰ä¸€ä¸ªè¯·æ±‚è¢«å¤„ç†ï¼Œå¹¶å‘æ€§èƒ½å¾ˆä½ã€‚

è¯è¯´åˆ°è¿™å„¿ï¼Œæˆ‘æƒ³ç”³æ˜ä¸€ç‚¹ï¼šnode.js ä¸åº”è¯¥è¢«é˜»å¡ï¼›èƒ½å¼‚æ­¥å¤„ç†çš„æ–¹æ³•å¼‚æ­¥å¤„ç†ï¼ˆå¦‚ä½¿ç”¨ fs.readFile()ï¼Œè€Œé fs.syncReadFile()fs.readFileSync()æ–¹æ³•ï¼‰ã€‚

node ä¸­ä¸èƒ½é˜»å¡ï¼Œå¹¶ä¸ä»£è¡¨ node å¤–ä¸èƒ½é˜»å¡[åŸæ–‡](/http://www.nodeclass.com/articles/310731)ã€‚

```js
/*
  ç”¨ async æ¥æä¸€ä¸ª
  å†æ åœ¨ fibersä¸­å®ç°é˜»å¡

*/
const async = require("async");
console.log("async start");
(async () => {
  console.log(1);
  await new Promise(reslove => {
    setTimeout(() => {
      reslove();
    }, 2000);
  });
  console.log(2);
})();
console.log("async end", "--");

// æä¸ªæˆç†Ÿç‚¹çš„
var Fiber = require("fibers");
var http = require("http");
var html = "";
Fiber(function() {
  var httpFiber = Fiber.current;
  html = "";
  http.get("http://www.baidu.com", function(res) {
    var dataFiber = Fiber.current;
    res.on("data", function(data) {
      html += data;
    });
    res.on("end", function(data) {
      httpFiber.run();
    });
  });
  Fiber.yield();
  console.log(html);
}).run();
console.log(html);
```

fibers çš„è¿è¡Œå¹¶ä¸åœ¨ node è¿›ç¨‹ä¸­ï¼Œæ‰€ä»¥åœ¨ fibers å†…éƒ¨å®ç°é˜»å¡å¯¹ node æ•´ä½“çš„æ€§èƒ½å¹¶æ²¡æœ‰å½±å“ã€‚è€Œä¸”å®ç°èµ·æ¥ä¹Ÿæ˜¯ç›¸å½“å®¹æ˜“ï¼Œåªéœ€è¦åœ¨æƒ³é˜»å¡çš„æ—¶å€™ï¼ŒæŠŠ fiber yield æ‰ã€‚éœ€è¦ç»§ç»­è¿è¡Œï¼Œåˆ™æ‰§è¡Œ run()æ¢å¤ fiberã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å½“ http.get è¯·æ±‚å‘èµ·æ—¶é˜»å¡å½“å‰ç¨‹åºï¼Œå½“æ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæˆæ—¶ï¼Œæ¢å¤ç¨‹åºã€‚

äºæ˜¯æˆ‘ä»¬åœ¨è°ƒç”¨ http.get åä½¿ç”¨ Fiber.yield()ä¸­æ–­æ­¤ fiberã€‚åœ¨å¯¹ response çš„ç›‘å¬ä¸­ï¼Œå¦‚æœè§¦å‘ end äº‹ä»¶è¡¨æ˜æ•°æ®ä¼ è¾“å®Œæˆï¼Œäºæ˜¯åœ¨ end çš„å›è°ƒå‡½æ•°ä¸­ï¼Œè°ƒç”¨ Fiber.current.run()æ¢å¤ fiberï¼Œè¿™æ ·ï¼Œåç»­çš„ä»£ç å°±ä»¥åŒæ­¥çš„æ–¹å¼æ‹¿åˆ° http.get è¯·æ±‚çš„æ•°æ®

::: warning
ğŸ‘† å¾ˆé¡ºåˆ©æˆ‘ä»¬å®ç°äº†ï¼Œä½†æ˜¯ä¸Šé¢ä¸¤ç§æ–¹æ³•éƒ½åªæ˜¯ä¸€ä¸ªç¯å¢ƒä¸­é˜»å¡å¹¶ä¸åƒ readdir ä¸ readdirSync
â“ å¦‚ä½•è®©ä»–åƒä¸Šé—¨ä»¥å¼‚å¯ä»¥åœ¨å…¨å±€ç¯å¢ƒä¸­é˜»å¡å‘¢ï¼Ÿ
:::
