<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>防抖和节流 | Guanyuhao</title>
    <meta name="description" content="前端">
    <link rel="icon" href="/myblog/yuhao.jpg">
    
    <link rel="preload" href="/myblog/assets/css/0.styles.e28427c6.css" as="style"><link rel="preload" href="/myblog/assets/js/app.32733ec0.js" as="script"><link rel="preload" href="/myblog/assets/js/2.85912592.js" as="script"><link rel="preload" href="/myblog/assets/js/16.24c38144.js" as="script"><link rel="prefetch" href="/myblog/assets/js/10.9cce5f95.js"><link rel="prefetch" href="/myblog/assets/js/11.7c0bf2d9.js"><link rel="prefetch" href="/myblog/assets/js/12.7223a4cc.js"><link rel="prefetch" href="/myblog/assets/js/13.dc55bf54.js"><link rel="prefetch" href="/myblog/assets/js/14.9562c25b.js"><link rel="prefetch" href="/myblog/assets/js/15.885f48d0.js"><link rel="prefetch" href="/myblog/assets/js/17.2f85edbd.js"><link rel="prefetch" href="/myblog/assets/js/18.afe8b4ce.js"><link rel="prefetch" href="/myblog/assets/js/19.2a9205ca.js"><link rel="prefetch" href="/myblog/assets/js/20.9f355e30.js"><link rel="prefetch" href="/myblog/assets/js/21.3a3ea704.js"><link rel="prefetch" href="/myblog/assets/js/22.26dc15bd.js"><link rel="prefetch" href="/myblog/assets/js/23.16d40f9f.js"><link rel="prefetch" href="/myblog/assets/js/24.5993bfb0.js"><link rel="prefetch" href="/myblog/assets/js/25.cd4f4671.js"><link rel="prefetch" href="/myblog/assets/js/26.a177cde8.js"><link rel="prefetch" href="/myblog/assets/js/27.294616a2.js"><link rel="prefetch" href="/myblog/assets/js/28.497d5ac0.js"><link rel="prefetch" href="/myblog/assets/js/29.512827f7.js"><link rel="prefetch" href="/myblog/assets/js/3.99f28c45.js"><link rel="prefetch" href="/myblog/assets/js/4.7a966d5b.js"><link rel="prefetch" href="/myblog/assets/js/5.2df3d064.js"><link rel="prefetch" href="/myblog/assets/js/6.c9964d57.js"><link rel="prefetch" href="/myblog/assets/js/7.610c1283.js"><link rel="prefetch" href="/myblog/assets/js/8.594b9603.js"><link rel="prefetch" href="/myblog/assets/js/9.4fae3246.js">
    <link rel="stylesheet" href="/myblog/assets/css/0.styles.e28427c6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myblog/" class="home-link router-link-active"><!----> <span class="site-name">Guanyuhao</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/cs/" class="nav-link">计算机通识</a></li><li class="dropdown-item"><!----> <a href="/myblog/FrontEnd/" class="nav-link router-link-active">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/guanyuhao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试" class="dropdown-title"><span class="title">面试</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myblog/cs/" class="nav-link">计算机通识</a></li><li class="dropdown-item"><!----> <a href="/myblog/FrontEnd/" class="nav-link router-link-active">前端</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="GitHub" class="dropdown-title"><span class="title">GitHub</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/guanyuhao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/myblog/FrontEnd/" class="sidebar-link">前端</a></li><li><a href="/myblog/FrontEnd/Vue.html" class="sidebar-link">Vue</a></li><li><a href="/myblog/FrontEnd/webHooks-Nuxt.html" class="sidebar-link">webhooks-nuxt</a></li><li><a href="/myblog/FrontEnd/webpack说明.html" class="sidebar-link">聊一聊 webpack</a></li><li><a href="/myblog/FrontEnd/垃圾回收机制.html" class="sidebar-link">垃圾回收机制</a></li><li><a href="/myblog/FrontEnd/安全.html" class="sidebar-link">安全</a></li><li><a href="/myblog/FrontEnd/性能.html" class="sidebar-link">性能</a></li><li><a href="/myblog/FrontEnd/框架通识.html" class="sidebar-link">框架通识</a></li><li><a href="/myblog/FrontEnd/浏览器.html" class="sidebar-link">浏览器</a></li><li><a href="/myblog/FrontEnd/节流和防抖.html" class="active sidebar-link">防抖和节流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#防抖" class="sidebar-link">防抖</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#应用场景" class="sidebar-link">应用场景</a></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#原理" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#两种版本" class="sidebar-link">两种版本</a></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#实现代码及思路" class="sidebar-link">实现代码及思路</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#节流" class="sidebar-link">节流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#应用场景-2" class="sidebar-link">应用场景:</a></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#原理-2" class="sidebar-link">原理</a></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#实现代码及思路-2" class="sidebar-link">实现代码及思路</a></li></ul></li><li class="sidebar-sub-header"><a href="/myblog/FrontEnd/节流和防抖.html#总结" class="sidebar-link">总结</a></li></ul></li><li><a href="/myblog/FrontEnd/跨域以及解决.html" class="sidebar-link">跨域以及解决</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="防抖和节流"><a href="#防抖和节流" class="header-anchor">#</a> 防抖和节流</h1> <ul><li>相同：不影响客户体验的前提下，讲频繁的回调函数，进行缩减，避免大量计算导致页面卡顿。</li> <li>不同：防抖是将多次执行变成最后一次执行，节流是将多次执行变为在规定时间内执行一次。</li></ul> <h2 id="防抖"><a href="#防抖" class="header-anchor">#</a> 防抖</h2> <ul><li><strong>定义</strong> <ul><li>触发事件后再规定时间内回调函数只执行一次,如果规定时间又触发了该事件，则会重新开始算规定时间。</li> <li>比喻：法师释放技能前的读条，技能读条没玩再次按技能会重新读条。</li> <li>总结：延时执行</li></ul></li></ul> <h3 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h3> <ul><li>两个条件:
<ul><li>1.如果客户连续操作会导致频繁的事件回调（可能引起页面卡顿）</li> <li>2.客户只关心“最后一次”操作所返回的结果</li></ul></li> <li>ex:
<ul><li>输入搜索联想，用户不断输入值，防抖节约资源请求。</li> <li>按钮点击：收藏、点赞、心标。</li></ul></li></ul> <h3 id="原理"><a href="#原理" class="header-anchor">#</a> 原理</h3> <p>通过定时器将回调函数进行延时，如果在规定时间内有继续回调，发现之前存在定时器，则清除该定时器，重新设置定时器,这里有个细节,就是后面所有的回调函数都要能访问到之前设置的定时器,这时就需要用到闭包(详见后面提到的)</p> <h3 id="两种版本"><a href="#两种版本" class="header-anchor">#</a> 两种版本</h3> <ul><li>1)非立即执行版：事件触发-&gt;延时-&gt;执行回调函数；如果延时中，继续触发事件，则重新延时。在延时结束后执行回调函数。
例子:input 搜索框，客户输完过一会自动搜索（500ms）</li> <li>2)立即执行版：事件触发-&gt;执行回调函数-&gt;延时；如果在延时中，继续触发事件，则重新延时，延时结束后，并不执行回调函数。
例子：按钮防点击。如点赞，心标，收藏，等立即反馈的按钮。</li></ul> <h3 id="实现代码及思路"><a href="#实现代码及思路" class="header-anchor">#</a> 实现代码及思路</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//非立即执行版</span>
<span class="token comment">//首先准备我们需要使用的回调函数</span>
<span class="token keyword">function</span> <span class="token function">shotCat</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;赞！！！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//包装函数</span>
<span class="token comment">//1 保存定时器标识</span>
<span class="token comment">//2 返回闭包函数 1)对定时器的判断清除;2)一般还需要保存函数的参数(一般就是事件返回的对象)和上下文(定时器存在this隐式丢失,详情可以看我不知道的js上)</span>
<span class="token comment">//最后补充一句,这里不建议通过定义一个全局变量来替代闭包保存定时器标识.</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fun<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">500</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//let timer = null 保存定时器</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _args <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token comment">//这里对定时器的设置有两种方法,第一种就是将定时器保存在函数(函数也是对象)的属性上,</span>
    <span class="token comment">//这种写法,很简便,但不是很常用</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>fun<span class="token punctuation">.</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fun<span class="token punctuation">.</span>timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//另外一种写法就是我们比较常见的</span>
    <span class="token comment">//if (timer) clearTimeout(timer);     相比上面的方法,这里多一个判断</span>
    <span class="token comment">//timer = setTimeout(function () {</span>
    <span class="token comment">//    fun.call(that, _args)</span>
    <span class="token comment">//}, delay)</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//接着用变量保存保存 debounce 返回的带有延时功能的函数</span>
<span class="token keyword">let</span> debounceShotCat <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span>shotCat<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//最后添加事件监听 回调debounceShotCat 并传入事件返回的对象</span>
<span class="token keyword">let</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;debounce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;keyup&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">debounceShotCat</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//带有立即执行选项的防抖函数:</span>
<span class="token comment">//思路和上面的大致相同,如果是立即执行,则定时器中不再包含回调函数,而是在回调函数执行后,仅起到延时和重置定时器标识的作用</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fun<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span> immediate <span class="token operator">=</span> <span class="token boolean">true</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//保存定时器</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _args <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//不管是否立即执行都需要首先清空定时器</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>immediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//如果定时器不存在,则说明延时已过,可以立即执行函数</span>
      <span class="token comment">//不管上一个延时是否完成,都需要重置定时器</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">//到时间后,定时器自动设为null,不仅方便判断定时器状态还能避免内存泄露</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果是非立即执行版,则重新设定定时器,并将回调函数放入其中</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="节流"><a href="#节流" class="header-anchor">#</a> 节流</h2> <p><strong>定义</strong>
当持续触发事件时，在规定时间段内只能调用一次回调函数。如果在规定时间内又触发了该事件，则什么也不做,也不会重置定时器
<strong>与防抖比较</strong>
防抖是将多次执行变为最后一次执行，节流是将多次执行变为在规定时间内只执行一次.一般不会重置定时器. 即不会 if (timer) clearTimeout(timer);(时间戳+定时器版除外)</p> <h3 id="应用场景-2"><a href="#应用场景-2" class="header-anchor">#</a> 应用场景:</h3> <ul><li><strong>两个条件:</strong> <ul><li>1.客户连续频繁地触发事件</li> <li>2.客户不再只关心&quot;最后一次&quot;操作后的结果反馈.而是在操作过程中持续的反馈.</li></ul></li> <li>ex:
<ul><li>鼠标不断点击触发，点击事件在规定时间内只触发一次(单位时间内只触发一次)</li> <li>监听滚动事件，比如是否滑到底部自动加载更多，用 throttle 来判断</li> <li>注意 :何为连续频繁地触发事件,就是事件触发的时间间隔至少是要比规定的时间要短.</li></ul></li></ul> <h3 id="原理-2"><a href="#原理-2" class="header-anchor">#</a> 原理</h3> <p>节流有两种实现方式</p> <ul><li>时间戳方式:通过闭包保存上一次的时间戳,然后与事件触发的时间戳比较.如果大于规定时间,则执行回调.否则就什么都不处理.
特点:<br>
一般第一次会立即执行，之后连续频繁地触发事件，也是超过了规定时间才会执行一次。 <br>
最后一次触发事件，也不会执行(说明:如果你最后一次触发时间大于规定时间,这样就算不上连续频繁触发了)<br></li> <li>定时器方式:原理与防抖类似.通过闭包保存上一次定时器状态.然后事件触发时,如果定时器为 null(即代表此时间隔已经大于规定时间),则设置新的定时器.到时间后执行回调函数,并将定时器置为 null.
特点:<br>
当第一次触发事件时，不会立即执行函数，到了规定时间后才会执行。 之后连续频繁地触发事件，也是到了规定时间才会执行一次(因为定时器)。<br>
当最后一次停止触发后，由于定时器的延时，还会执行一次回调函数(那也是上一次成功成功触发执行的回调,而不是你最后一次触发产生的)。<br>
一句话总结就是延时回调,你能看到的回调都是上次成功触发产生的,而不是你此刻触发产生的.</li> <li>说明:
这两者最大的区别:是时间戳版的函数触发是在规定时间开始的时候，而定时器版的函数触发是在规定时间结束的时候。 具体理解请结合后面的代码实例.</li></ul> <h3 id="实现代码及思路-2"><a href="#实现代码及思路-2" class="header-anchor">#</a> 实现代码及思路</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//时间戳版：</span>
<span class="token comment">//这里fun指的就是回调函数,我就不写出来了</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fun<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">500</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//记录上一次触发的时间戳.这里初始设为0,是为了确保第一次触发产生回调</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//记录此刻触发时的时间戳</span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _args <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous <span class="token operator">&gt;</span> delay<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果时间差大于规定时间,则触发</span>
      <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      previous <span class="token operator">=</span> now<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//定时器版:</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fun<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">500</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _args <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//如果定时器不存在,则设置新的定时器,到时后,才执行回调,并将定时器设为null</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//时间戳+定时器版: 实现第一次触发可以立即响应,结束触发后也能有响应 (该版才是最符合实际工作需求)</span>
<span class="token comment">//该版主体思路还是时间戳版,定时器的作用仅仅是执行最后一次回调</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fun<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">500</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> previous <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> now <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> remaining <span class="token operator">=</span> delay <span class="token operator">-</span> <span class="token punctuation">(</span>now <span class="token operator">-</span> previous<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//距离规定时间,还剩多少时间</span>
    <span class="token keyword">let</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> _args <span class="token operator">=</span> args<span class="token punctuation">;</span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清除之前设置的定时器</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>remaining <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">fun</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>that<span class="token punctuation">,</span> _args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      previous <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>fun<span class="token punctuation">,</span> remaining<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//因为上面添加的clearTimeout.实际这个定时器只有最后一次才会执行</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>实际工作总，一般会 3 种场景下采用节流跟防抖</p> <ol><li>input 框 输入联想，搜索 change 多次规定 500ms 最后执行 =&gt; 防抖最后执行版</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> debounceInputChange <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span>inputChange<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>关注，收藏，等需要立即反应的操作，且客户只关系最后一次的结果 =&gt; 防抖立即执行版</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> debounceBtnClick <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span>BtnClick<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>滚动加载，这应该是节流最常见的场景了，需要再事件触发过程中出现持续性的反馈 =&gt; 节流</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> throttleScrollLoad <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span>ScrollLoad<span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>日常开发中，我们可能还会遇到更多可以使用到节流跟防抖的场景，可以再下面讨论，多具体的 ex 再扩展</li></ol> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/3/2019, 8:40:11 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/myblog/FrontEnd/浏览器.html" class="prev">浏览器</a></span> <span class="next"><a href="/myblog/FrontEnd/跨域以及解决.html">跨域以及解决</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/myblog/assets/js/app.32733ec0.js" defer></script><script src="/myblog/assets/js/2.85912592.js" defer></script><script src="/myblog/assets/js/16.24c38144.js" defer></script>
  </body>
</html>
